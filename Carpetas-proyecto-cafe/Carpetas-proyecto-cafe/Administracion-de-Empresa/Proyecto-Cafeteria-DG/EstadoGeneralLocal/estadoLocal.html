<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estado General del Local</title>
    <link rel="stylesheet" href="indexP.css">
    <link rel="stylesheet" href="estadoLocal.css">
    <script defer src="indexP.js"></script>
    <script src="/solicitud_fetch.js"></script>

<style>

     #dialog-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
    }

    #dialog-box {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #946f58;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      text-align: center;
    }

    label {
      display: block;
      margin-bottom: 10px;
      color: black;
    }

    input, select {
      width: 100%;
      padding: 8px;
      margin-bottom: 15px;
      box-sizing: border-box;
    }

    #close-btn {
      background-color: #f44336;
      color: #fff;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
    }
    #submit-btn {
      background-color: #31d810;
      color: #fff;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
    }
    .add-to-cartOrdenar {
    background-color: #946f58;
    color: white;
    border: none;
    padding: 10px 20px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin: 4px 2px;
    cursor: pointer;
    border-radius: 4px;
}
</style>




</head>
<body>
    <!--
        Encabezado
    -->
    <header>
        <img id="logo" src="logo.png" alt="">
        <h1 style="color: #474740;" id="tituloMenu">Estado general del local</h1>
    </header>
    <!--
       Fin Encabezado
    --> 
    <!--
        Mis pedidos
    -->
    <section id="Pedidos">
        <div id="Pedido 1" class="Pedido">
            <div class="InfoPedido">
                <h3>Estado de ventas</h3>
                
            </div>
            <button class="Expandir">
                <img src="impresora.png" alt="" class="btnExpand">
            </button>
        </div>

        <div id="Pedido 2" class="Pedido">
            <div class="InfoPedido">
                <h3>Raiting de productos mas consumidos</h3>
                
            </div>
            <button class="Expandir">
                <img src="impresora.png" alt="" class="btnExpand">
            </button>
        </div>

        <div id="Pedido 3" class="Pedido">
            <div class="InfoPedido">
                <h3>Raiting de calificaciones del local</h3>
            </div>
            <button class="Expandir">
                <img src="impresora.png" alt="" class="btnExpand">
            </button>
        </div>

        <div id="Pedido 3" class="Pedido">
            <div class="InfoPedido">
                <h3>Raiting de calificaciones de repartidores</h3>
            </div>
            <button class="Expandir">
                <img src="impresora.png" alt="" class="btnExpand">
            </button>
        </div>

        <div id="Pedido 3" class="Pedido">
            <div class="InfoPedido">
                <h3>Reporte de pedidos en proceso</h3>
            </div>
            <button class="Expandir">
                <img src="impresora.png" alt="" class="btnExpand">
            </button>
        </div>
    </section>


    <div style="margin-left: 88%; margin-bottom: 10px;"><button class="add-to-cartOrdenar" id="open-btn"><i class="fas fa-cart-plus"></i> Agregar Producto</button></div>

    <div id="dialog-overlay">
        <div id="dialog-box">
          <h2>Formulario de Producto</h2>
          <label for="product-type">Tipo de Producto:</label>
          <select id="product-type">
            <option value="Bebida">Bebida</option>
            <option value="Comida">Comida</option>
            <option value="Postre">Postre</option>
          </select>
      
          <label for="product-name">Nombre:</label>
          <input type="text" id="product-name" required>
      
          <label for="product-price">Precio:</label>
          <input type="number" id="product-price" required>
      
          <label for="product-image">Imagen</label>
          <input type="file" id="product-image" accept="image/*" required>
      
          <button id="submit-btn">Enviar</button>
          <button id="close-btn">Cerrar</button>
        </div>
      </div>
    



 <!--
        Menu
    -->
    <div id="sidebar" class="sidebar">
        <a href="#" class="boton-cerrar" onclick="ocultar()"><img src="boton.png" alt=""></a>
        <ul class="menu">
            <li><a href="../EstadoGeneralLocal/estadoLocal.html">Estado del local</a></li>
            <li><a href="../EstadoGeneralEmpresa/estadoEmpresa.html">Estado de la empresa</a></li>
            
        </ul>
    </div>

    <div id="contenido" class="sidebar2">
     <a id="abrir" class="abrir-cerrar" href="javascript:void(0)" onclick="mostrar()" ><img src="boton.png" alt=""></a>
    </div>
    <!--
       Fin Menu
    -->

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script>
     $(document).ready(function() {
      $("#open-btn").click(function() {
        $("#dialog-overlay").fadeIn();
      });
    
      $("#close-btn").click(function() {
        $("#dialog-overlay").fadeOut();
      });
    
      $("#submit-btn").click(function() {
    
        // Obtener los valores del formulario
        const productType = $("#product-type").val();
        const productName = $("#product-name").val();
        const productPrice = $("#product-price").val();
        //const productImage = $("#product-image")[0].files[0];
        const productImageInput = $("#product-image")[0]; // Obtener el elemento input de tipo file
        const productImage = productImageInput.files[0]; // Obtener el archivo seleccionado
    
        function obtenerMayusculas(s) {
        // Utiliza una expresión regular para eliminar caracteres que no son letras
        // y luego convierte la cadena resultante a mayúsculas
        return s.replace(/[^A-Za-z]/g, '').toUpperCase();
         } 
    
    /*********/
    
    //Realizacion del GET para traer el mas grande y despues Realizar el post
    // Se realizo todo adentro del get ya que es asincrono y no me permitia sacar el numero mas alto del obtener
    
    
    // Función para obtener el número más alto de id_producto
    async function obteneridproducto() {
      let url = "http://apibluehour.com/productos?columnas=*";
      let init = {
        method: 'get',
        header: {
          'Content-Type': 'application/json'
        }
      };
    
      let objdatos = await fetchSynchronousGET(url, init);
    
      if (objdatos.status == 200) {
        let datos = objdatos.datos;
        let ids = datos.map(element => element.id_producto);
        return Math.max(...ids) + 1;
      }
    }
    
    // Función para obtener el número y crear la estructura productData
    async function obtenerYCrearProductData() {
      // Obtener el número más alto de id_producto
      const idProducto = await obteneridproducto();
    
      // Resto del código para obtener los valores del formulario
      const productType = $("#product-type").val();
      const productName = $("#product-name").val();
      const productPrice = $("#product-price").val();
      const productImageInput = $("#product-image")[0];
      const productImage = productImageInput.files[0];
    
      // Crear la estructura productData con el número obtenido
      const productData = {
        id_producto: idProducto,
        tipo_producto: productType,
        descripcion_producto: productName,
        precio_producto: productPrice,
        img_producto: 'http://bluehour.com/Menu/imagenes/MENU/' + obtenerMayusculas(productType) + '/' + productImage.name,
        existencia_producto: 0,
        vendidos_producto: 0,
      };
    
      // Configurar las opciones de la solicitud POST
      const requestOptions = {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(productData),
      };
    
      // Realizar la solicitud POST a la URL deseada
      const apiUrl = 'http://apibluehour.com/productos'; // Reemplaza con la URL de tu API
      fetchSynchronousPOST(apiUrl, requestOptions)
        .then(response => {
          // Manejar la respuesta de la solicitud POST
          console.log(response);
          // Puedes realizar acciones adicionales aquí según la respuesta
        })
        .catch(error => {
          // Manejar errores de la solicitud POST
          console.error('Error al enviar la solicitud POST:', error);
        });
    }
    
    // Llamar a la función para obtener y crear productData
    obtenerYCrearProductData();
    
    //METODO POST SOLAMENTE
    
      /*
        // Crear un objeto con la estructura deseada
        const productData = {
          
          id_producto: 13,
          tipo_producto: productType, // Cambiado a 'type' para demostración
          descripcion_producto: productName, // Cambiado a 'name' para demostración
          precio_producto: productPrice, // Ajustado al nombre de la columna en tu base de datos
          // Puedes agregar más campos según tus necesidades
          img_producto: 'http://bluehour.com/Menu/imagenes/MENU/'+obtenerMayusculas(productType)+'/'+ productImage.name,
          existencia_producto: 0,
          vendidos_producto: 0,
    
    
        };
    
        // Configurar las opciones de la solicitud POST
        const requestOptions = {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(productData),
        };
    
        // Realizar la solicitud POST a la URL deseada
        const apiUrl = 'http://apibluehour.com/productos'; // Reemplaza con la URL de tu API
        fetchSynchronousPOST(apiUrl, requestOptions)
          .then(response => {
            // Manejar la respuesta de la solicitud POST
            console.log(response);
            // Puedes realizar acciones adicionales aquí según la respuesta
          })
          .catch(error => {
            // Manejar errores de la solicitud POST
            console.error('Error al enviar la solicitud POST:', error);
          });*/
    
    
      });
    });
    
    
    </script>
    




</body>
</html>